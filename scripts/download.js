webpackJsonp([10],{135:function(module,exports,__webpack_require__){__webpack_require__(0),module.exports=__webpack_require__(62)},62:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_jquery=__webpack_require__(1),_jquery2=_interopRequireDefault(_jquery),_modal=__webpack_require__(41),_modal2=_interopRequireDefault(_modal),_page=__webpack_require__(29),_config=__webpack_require__(28),_config2=_interopRequireDefault(_config),_payment=__webpack_require__(42),_payment2=_interopRequireDefault(_payment);Promise.all([_config2.default,_jquery2.default,_payment2.default,_modal2.default]).then(function(_ref){var _ref2=_slicedToArray(_ref,3),config=_ref2[0],$=_ref2[1],Payment=_ref2[2];console.log("Config at download.js:"),console.log(config);var payment=new Payment(config.release.title+" "+config.release.version);$(document).ready(function(){function updateDownloadButton(){var translateDownload=$("#translate-download").text(),translatePurchase=$("#translate-purchase").text();$("#choice-buttons").children().length<=1?$("#download").text(translateDownload):$("button.payment-button").hasClass("checked")||100*$("#amount-custom").val()>=paymentMinimum||""===$("#amount-custom").val()?$("#download").text(translatePurchase):$("#download").text(translateDownload)}function doStripePayment(amount,token){return 0!==$("#amount-twenty").val()&&($("#pay-what-you-want").remove(),$("#choice-buttons").remove(),$("#amounts").append('<div id="choice-buttons"><input type="hidden" id="amount-twenty" value="0"></div>'),currentButton="amount-twenty",updateDownloadButton()),new Promise(function(resolve,reject){$.post((0,_page.url)()+"/api/payment",{description:config.release.title+" "+config.release.version,amount:amount,token:token.id,email:token.email,os:detectedOS}).done(function(res){return resolve(res)}).fail(function(xhr,status){return reject(new Error(status))})})}function openDownloadOverlay(){var $openModal;$openModal=$(".open-modal"),console.log("Open the download overlay!"),$openModal.leanModal({closeButton:".close-modal",disableCloseOnOverlayClick:!0}),$openModal.click()}var paymentMinimum=100,currentButton="amount-twenty",previousButton="amount-twenty",amountSelect=function(e){var targetID=$(e.target).attr("id");console.log("Setting payment target to #"+targetID),currentButton!==targetID&&(previousButton=currentButton),currentButton=targetID,$(".target-amount").removeClass("checked"),$("#"+currentButton).addClass("checked"),updateDownloadButton()};$(".target-amount").on("click focusin",amountSelect);var amountValidate=function(event){var currentVal=$("#amount-custom").val(),code=event.which||event.keyCode||event.charCode;46===code&&-1===currentVal.indexOf(".")||-1!==[8,37,39].indexOf(code)||!(code<48||code>57)||event.preventDefault()};$("#amount-custom").keypress(amountValidate);var amountBlur=function(){var i=document.getElementById("amount-custom");i.validity.valid&&""!==i.value||($(".target-amount").removeClass("checked"),currentButton=previousButton,$("#"+currentButton).addClass("checked"),updateDownloadButton())};$("#amount-custom").blur(amountBlur),$("#choice-buttons").on("click",updateDownloadButton),$("#choice-buttons input").on("input",updateDownloadButton),updateDownloadButton(),$("#download").click(function(){console.log("Payment initiated with selection "+currentButton);var paymentAmount=100*$("#"+currentButton).val();console.log("Starting payment for "+paymentAmount),Number.isNaN(paymentAmount)||paymentAmount<paymentMinimum?(ga("send","event",config.release.title+" "+config.release.version+" Payment (Skip)","Homepage",paymentAmount),openDownloadOverlay()):(ga("send","event",config.release.title+" "+config.release.version+" Payment (Initiated)","Homepage",paymentAmount),payment.checkout(paymentAmount,"USD").then(function(_ref3){var _ref4=_slicedToArray(_ref3,1),token=_ref4[0];return doStripePayment(paymentAmount,token)}).then(function(){return openDownloadOverlay()}).then(function(){return ga("send","event",config.release.title+" "+config.release.version+" Payment (Complete)","Homepage",paymentAmount)}).catch(function(err){throw console.error("Error while making payment"),console.error(err),ga("send","event",config.release.title+" "+config.release.version+" Payment (Failed)","Homepage",paymentAmount),openDownloadOverlay(),err}))});var detectedOS=function(){var ua=window.navigator.userAgent;return null==ua||!1===ua?"Other":ua.indexOf("Android")>=0?"Android":ua.indexOf("Mac OS X")>=0&&ua.indexOf("Mobile")>=0?"iOS":ua.indexOf("Windows")>=0?"Windows":ua.indexOf("Mac_PowerPC")>=0||ua.indexOf("Macintosh")>=0?"macOS":ua.indexOf("Linux")>=0?"Linux":"Unknown"}();$(".download-link").click(function(){ga("send","event",config.release.title+" "+config.release.version+" Download (OS)","Homepage",detectedOS),ga("send","event",config.release.title+" "+config.release.version+" Download (Region)","Homepage",config.user.region)}),$(".download-link.http").click(function(){ga("send","event",config.release.title+" "+config.release.version+" Download (Method)","Homepage","HTTP")}),$(".download-link.magnet").click(function(){ga("send","event",config.release.title+" "+config.release.version+" Download (Method)","Homepage","Magnet")}),console.log("Loaded download.js")})})}},[135]);
//# sourceMappingURL=download.map.js